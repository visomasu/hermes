Register users to receive daily SLA violation notifications for their work items and direct reports.

## Trigger
User requests: "register for SLA", "sign me up for SLA", "enable SLA notifications", "start tracking SLAs", "register for work item notifications"

Users may also specify area paths: "register me for SLA in Project\\Team1" or "register for SLA notifications for Project\\Team1 and Project\\Team2"

## ⚠️ CRITICAL: Parameter Extraction

**YOU MUST extract teamsUserId from the system message BEFORE calling the tool.**

The system message will contain (look for "User Context Override"):
```
## User Context Override
Current user: visomasu@microsoft.com (Teams User ID for tool calls)
```

**YOUR TOOL CALL MUST LOOK LIKE THIS:**
```json
{
  "teamsUserId": "visomasu@microsoft.com",
  "areaPaths": ["Project\\Team1", "Project\\Team2"]
}
```

**CORRECT EXAMPLES:**
- System says "Current user: alice@contoso.com" → Use: `{"teamsUserId": "alice@contoso.com"}`
- System says "Current user: bob@fabrikam.com" → Use: `{"teamsUserId": "bob@fabrikam.com"}`

**WRONG - DO NOT DO THIS:**
- ❌ `{"teamsUserId": ""}` - Empty string
- ❌ `{"teamsUserId": "<userId>"}` - Placeholder text
- ❌ `{"teamsUserId": "{{userId}}"}` - Template syntax
- ❌ Omitting teamsUserId field entirely

If you cannot find the user ID in system messages, ask the user to provide it explicitly.

---

## Process

**1. Identify User Intent**
Parse user input for registration keywords and extract any area path specifications. Confirm intent if ambiguous.

**2. Extract Area Paths (Optional)**
If user mentions area paths in their request, extract them from the natural language:
- "in Project\\Team" → areaPaths: ["Project\\Team"]
- "for Team1 and Team2" → areaPaths: ["Project\\Team1", "Project\\Team2"]
- No area path mentioned → areaPaths: null (checks all areas)

**3. Execute Registration**

Call the tool with the extracted teamsUserId and optional area paths:
```
UserManagementTool.Execute("RegisterSlaNotifications", {"teamsUserId": "<actual-user-id-from-system-message>", "areaPaths": ["Project\\Team1"]})
```

If no area paths are specified, omit the areaPaths field or set to null.

This automatically:
- Fetches user's Azure AD email via Microsoft Graph
- Determines if user is a manager (has direct reports)
- Retrieves direct report emails for managers
- Stores area paths for filtering (optional)
- Stores registration in UserConfiguration
- Enables SLA violation notifications

**4. Communicate Result**
For managers:
"✅ Registered successfully! You'll receive daily SLA reports for your team (X direct reports) and your own work items."

For individual contributors:
"✅ Registered successfully! You'll receive daily SLA reports for your work items."

## Manager vs IC Behavior

**Manager (has direct reports):**
- Receives ONE daily digest with violations from entire team
- Digest grouped by owner email
- Shows manager's own violations separately from team violations
- Detailed view for teams ≤5 people, aggregated view for larger teams

**Individual Contributor (no direct reports):**
- Receives daily digest with only their own violations
- Focused on their assigned work items

## Important Notes

- Registration is automatic via Microsoft Graph API (no manual email entry)
- Manager status derived from direct reports in Azure AD
- Area paths are optional: if not specified, all area paths are monitored
- Area paths apply to user and all direct reports (if manager)
- Notifications respect quiet hours and throttling rules (NotificationGate)
- Users can check SLA violations on-demand anytime (without registration)
- Silent registration: direct reports are not notified when manager registers

## Related Capabilities

- **CheckSlaViolations:** Perform immediate on-demand SLA check
- **UnregisterSlaNotifications:** Remove user from daily notification list

## Error Handling

If email cannot be retrieved:
"Could not retrieve your email from Azure AD. Please contact support."

If registration fails:
"An error occurred during registration. Please try again later."
